                    МІНІСТЕРСТВО ОСВІТИ І НАУКИ УКРАЇНИ
   ХАРКІВСЬКИЙ НАЦІОНАЛЬНИЙ УНІВЕРСИТЕТ РАДІОЕЛЕКТРОНІКИ



                           Кафедра Програмної інженерії




                                        Звіт
                              з лабораторної роботи №4
                    з дисципліни: «Скриптові мови програмування»
з теми: «Структурування коду, робота з формами, автентифікація та авторизація»




Виконала:                                                             Перевірив:
ст. гр. ПЗПІ-23-1                                  Старший викладач кафедри ПІ
Третьякова Л. С.                                                   Сокорчук І. П.




                                   Харків – 2025
                                                                                  2
4 СТРУКТУРУВАННЯ КОДУ, РОБОТА З ФОРМАМИ, АВТЕНТИФІКАЦІЯ
                                  ТА АВТОРИЗАЦІЯ

     4.1 Історія змін

№ Дата                 Версія звіту     Опис змін та виправлень
1 12.05.2025           0.1              Створено звіт

     4.2 Мета роботи

     Навчитися масштабувати код програм, працювати з формами, здійснювати
авторизацію та обмеження прав доступу.

     4.3 Опис виконаної роботи

     Відповідно до завдань на цю лабораторну роботу перш за все необхідно було
прибрати дублювання шапки та підвалу сайту. Але у ході написання застосунку ще
починаючи з 3 лабораторної роботи не було дублювання функціоналу, і header.php
та footer.php були відокремлені один від одного:
         –   header.php містить HTML-код шапки сайту, включно з меню навігації,
             умовним відображенням пунктів Login/Logout залежно від стану
             авторизації користувача.
         –   footer.php містить HTML-код підвалу сайту.
     Було також реалізовано систему авторизації користувачів через сторінку
логіна. Додано сторінку login.php, що містить форму входу з полями для введення
логіна та пароля (див.рис. Б.1), а також сторінку register.php, якщо користувач
ще не зареєстрований у системі. Замість збереження облікових даних у файлі
credentials.php, логін та пароль зберігаються у базі даних MariaDB у таблиці
users. Після надсилання форми через POST-запит, введені дані перевіряються на
наявність, і далі здійснюється порівняння з даними з бази.
     У разі успішної авторизації, у сесії PHP зберігається ім’я користувача та час
входу:

     if (loginValid($username, $password)) {
             $_SESSION['user_id'] = getUserIdByUsername($username);
                                                                                     3
                  $_SESSION['username'] = $username;
                  $_SESSION['login_time'] = time();
                  header("Location: index.php");
              }
              else {
                  $error = 'Невірний логін або пароль.';
              }


      У шапці сайту (header.php) реалізовано умовне відображення пунктів меню:
якщо користувач не авторизований, відображається пункт Login, у протилежному
випадку — Logout.
      Якщо неавторизований користувач намагається отримати доступ до
захищених сторінок (наприклад, products.php, profile.php), він автоматично
перенаправляється на page404.php (див.рис. Б.2), що містить повідомлення про
необхідність авторизації. Також було реалізовано можливість виходу з акаунту
(Logout), що видаляє дані з сесії і повертає користувача на головну сторінку.
      Щодо профілю користувача, то було створено сторінку profile.php (див.рис.
Б.3), яка відображає форму з полями для редагування імені, прізвища, дати
народження, стислого опису та фотографії.
      Для завантаження зображення використовується форма, а саме зображення
зберігається на сервері (у теці uploads/), шлях до файлу — у базі даних (таблиця
users).
      Після натискання на кнопку «Зберегти», введені дані перевіряються на
відповідність умовам:
          –   поля не повинні бути порожніми;
          –   ім’я та прізвище мають бути рядками довжиною не менше 2 символів;
          –   вік користувача (на основі дати народження) повинен бути не менше 16
              років;
          –   коротка інформація — мінімум 50 символів;
          –   фото перевіряється на допустимі типи файлів (JPEG, PNG).

      if (isset($_FILES['photo']) && $_FILES['photo']['error'] ===
      UPLOAD_ERR_OK) {
              $fileTmp = $_FILES['photo']['tmp_name'];
              $fileName = basename($_FILES['photo']['name']);
              $fileExt = strtolower(pathinfo($fileName,
      PATHINFO_EXTENSION));
              $allowed = ['jpg', 'jpeg', 'png', 'gif'];
                                                                             4
             if (!in_array($fileExt, $allowed)) {
                 $errors[] = 'Дозволені лише JPG, JPEG, PNG, GIF.';
             } else {
                 $newFileName = 'uploads/user_' . time() . '.' . $fileExt;
                 if (!is_dir('uploads')) mkdir('uploads', 0777, true);

                  if (move_uploaded_file($fileTmp, $newFileName)) {
                      $profile['photo'] = $newFileName;
                  } else {
                      $errors[] = 'Не вдалося зберегти фото.';
                  }
             }
         }


     У разі успішної перевірки дані зберігаються у таблиці users.

     4.4 Висновки

     У ході виконання лабораторної роботи я навчилася масштабувати код програм,
працювати з формами, здійснювати авторизацію та обмеження прав доступу.
                                                                           5
                               ДОДАТОК А
                Відеозапис презентації лабораторної роботи

Відеозапис результатів лабораторної роботи: https://youtu.be/NmfIPjUTY5k
Хронологічний опис відеозапису:
00:00 - Вступ
00:27 - Демонстрація результатів
03:54 - Початок огляду коду, огляд структур таблиць бд
04:46 - Огляд коду user_management.php
06:39 - Огляд коду product_management.php
06:48 - Огляд cart_management.php
08:36 - Огляд коду page404.php
08:54 - Огляд коду profile.php
11:38 - Огляд коду login.php
12:43 - Огляд коду register.php
14:23 - Огляд коду cart.php
                                                    6
                 ДОДАТОК Б
               Графічні матеріали




     Рисунок Б.1 – Вигляд сторінки login.php




  Рисунок Б.2 – Вигляд сторінки «Не знайдено»




Рисунок Б.3 – Вигляд сторінки профілю profile.php
                                                                                          7
                                     ДОДАТОК В
                                   Програмний код

      В.1 { persistence/cart_management.php }

      GitHub    репозиторій:    https://github.com/NureTretiakovaLiliia/smp-pzpi-23-1-tretiakova-liliia/blob/main/Lab4/smp-pzpi-23-1-tretiakova-liliia-lab4/persistence/cart_management.php

      1 <?php
      2
      3 require 'persistence/database/db.php';
      4
      5 function getCartItems(int $user_id): array {
      6      global $pdo;
      7      $stmt = $pdo->prepare("
      8           SELECT ci.product_id, ci.quantity, p.title, p.price,
      p.imageUrl
      9           FROM cart_items_authorised ci
      10           JOIN products p ON ci.product_id = p.id
      11           WHERE ci.user_id = :user_id
      12      ");
      13      $stmt->execute(['user_id' => $user_id]);
      14      return $stmt->fetchAll();
      15 }
      16
      17 function addToCart(int $user_id, int $productId, int $quantity):
      void {
      18      global $pdo;
      19      $stmt = $pdo->prepare("
      20           INSERT INTO cart_items_authorised (user_id, product_id,
      quantity)
      21           VALUES (:user_id, :product_id, :quantity)
      22           ON DUPLICATE KEY UPDATE quantity = quantity + :quantity
      23      ");
      24      $stmt->execute([
      25           'user_id' => $user_id,
      26           'product_id' => $productId,
      27           'quantity' => $quantity
      28      ]);
      29 }
      30
      31 function clearCart(int $user_id): void {
      32      global $pdo;
      33      $stmt = $pdo->prepare("DELETE FROM cart_items_authorised
      WHERE user_id = :user_id");
      34      $stmt->execute(['user_id' => $user_id]);
      35 }
      36
      37 function removeFromCart(int $user_id, int $productId): void {
      38      global $pdo;
      39      $stmt = $pdo->prepare('DELETE FROM cart_items_authorised
      WHERE user_id = ? AND product_id = ?');
                                                                                       8
      40       $stmt->execute([$user_id, $productId]);
      41   }


      В.2 { persistence/database/create.sql }

      GitHub          репозиторій:https://github.com/NureTretiakovaLiliia/smp-pzpi-23-1-tretiakova-liliia/blob/main/Lab4/smp-pzpi-23-1-tretiakova-liliia-lab4/persistence/database/create.sql

      1 CREATE DATABASE smp_lab;
      2 USE smp_lab;
      3
      4 CREATE TABLE products (
      5       id INT AUTO_INCREMENT PRIMARY KEY,
      6       title VARCHAR(255) NOT NULL,
      7       description TEXT,
      8       imageUrl VARCHAR(255),
      9       price DECIMAL(10,2) NOT NULL
      10 );
      11
      12 CREATE TABLE users (
      13       id INT AUTO_INCREMENT PRIMARY KEY,
      14       username VARCHAR(100) NOT NULL UNIQUE,
      15       user_password VARCHAR(50) NOT NULL,
      16       image_url TEXT,
      17       created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
      18 );
      19
      20 CREATE TABLE cart_items_authorised (
      21       id INT AUTO_INCREMENT PRIMARY KEY,
      22       user_id INT NOT NULL,
      23       product_id INT NOT NULL,
      24       quantity INT NOT NULL DEFAULT 1,
      25
      26       UNIQUE (user_id, product_id),
      27       FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
      28       FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE
      CASCADE
      29 );
      30
      31
      32 ALTER TABLE users
      33 ADD COLUMN first_name VARCHAR(100),
      34 ADD COLUMN last_name VARCHAR(100),
      35 ADD COLUMN birth_date DATE,
      36 ADD COLUMN bio TEXT,
      37 ADD COLUMN photo VARCHAR(255);
                                                                                          9
      В.3 { persistence/database/db.php }

      GitHub          репозиторій:    https://github.com/NureTretiakovaLiliia/smp-pzpi-23-1-tretiakova-liliia/blob/main/Lab4/smp-pzpi-23-1-tretiakova-liliia-lab4/persistence/database/db.php

      1 <?php
      2
      3 try {
      4      $pdo = new
      PDO('mysql:host=localhost;dbname=smp_lab;charset=utf8mb4', 'my_user',
      'strong_password');
      5      $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
      6 } catch (PDOException $e) {
      7      die("Помилка підключення: " . $e->getMessage());
      8 }
      9
      10 ?>


      В.4 { persistence/database/insert.sql }

      GitHub          репозиторій:    https://github.com/NureTretiakovaLiliia/smp-pzpi-23-1-tretiakova-liliia/blob/main/Lab4/smp-pzpi-23-1-tretiakova-liliia-lab4/persistence/database/insert.sql

      1 INSERT INTO products (id, title, price) VALUES
      2 (1, 'Молоко “Селянське” 2,5%', 34.90),
      3 (2, 'Хліб пшеничний “Домашній”', 21.50),
      4 (3, 'Яйця курячі відбірні, 10 шт', 42.00),
      5 (4, 'Ковбаса “Лікарська” варена', 129.90),
      6 (5, 'Олія соняшникова рафінована, 1 л', 59.00),
      7 (6, 'Цукор білий кристалічний, 1 кг', 33.70),
      8 (7, 'Макарони “Золоте зерно” спіральки, 500 г', 28.40),
      9 (8, 'Картопля молода, 1 кг', 26.90),
      10 (9, 'Сир твердий “Голландський” 45%', 168.50),
      11 (10, 'Йогурт “Фруктовий вибух” з полуницею, 300 г', 24.30);


      В.5 { persistence/products_management.php }

      GitHub          репозиторій:    https://github.com/NureTretiakovaLiliia/smp-pzpi-23-1-tretiakova-liliia/blob/main/Lab4/smp-pzpi-23-1-tretiakova-liliia-lab4/persistence/products_management.php

      1   <?php
      2
      3   require 'persistence/database/db.php';
      4
                                                                                      10
      5
      6 function getAllProducts(): array {
      7     global $pdo;
      8     $stmt = $pdo->query("SELECT * FROM products");
      9     return $stmt->fetchAll();
      10 }


      В.6 { persistence/user_management.php }

      GitHub    репозиторій:    https://github.com/NureTretiakovaLiliia/smp-pzpi-23-1-tretiakova-liliia/blob/main/Lab4/smp-pzpi-23-1-tretiakova-liliia-lab4/persistence/user_management.php

      1 <?php
      2
      3 require 'database/db.php';
      4
      5
      6 function userExists(string $username): bool {
      7      global $pdo;
      8
      9      $stmt = $pdo->prepare("SELECT id FROM users WHERE username
      = :username");
      10      $stmt->execute(['username' => $username]);
      11
      12      return $stmt->fetch() !== false;
      13 }
      14
      15
      16 function loginValid(string $username, string $pwd): bool {
      17      global $pdo;
      18
      19      $stmt = $pdo->prepare("SELECT user_password FROM users WHERE
      username = :username");
      20      $stmt->execute(['username' => $username]);
      21      $user = $stmt->fetch(PDO::FETCH_ASSOC);
      22
      23      return $user && $pwd === $user['user_password'];
      24 }
      25
      26
      27 function getUserIdByUsername(string $username): int {
      28      global $pdo;
      29
      30      $stmt = $pdo->prepare("SELECT id FROM users WHERE username
      = :username");
      31      $stmt->execute([':username' => $username]);
      32      $row = $stmt->fetch(PDO::FETCH_ASSOC);
      33
      34      if ($row && isset($row['id'])) {
      35          return (int)$row['id'];
      36      }
      37
      38      return 0;
                                                                   11
      39 }
      40
      41
      42 function registerUser(string $username, string $pwd): bool {
      43      global $pdo;
      44
      45      $stmt = $pdo->prepare("INSERT INTO users (username,
      user_password) VALUES (:username, :password)");
      46
      47      return $stmt->execute([
      48          ':username' => $username,
      49          ':password' => $pwd
      50      ]);
      51 }
      52
      53
      54 function updateUserProfile(int $userId, array $data): bool {
      55      global $pdo;
      56
      57      $sql = "UPDATE users SET first_name = :first_name, last_name
      = :last_name,
      58              birth_date = :birth_date, bio = :bio, photo = :photo
      59              WHERE id = :id";
      60
      61      $stmt = $pdo->prepare($sql);
      62      return $stmt->execute([
      63          'first_name' => $data['first_name'],
      64          'last_name' => $data['last_name'],
      65          'birth_date' => $data['birth_date'],
      66          'bio' => $data['bio'],
      67          'photo' => $data['photo'],
      68          'id' => $userId
      69      ]);
      70 }
      71
      72 function getUserProfile(int $userId): array {
      73      global $pdo;
      74
      75      $stmt = $pdo->prepare("SELECT first_name, last_name,
      birth_date, bio, photo FROM users WHERE id = :id");
      76      $stmt->execute(['id' => $userId]);
      77      $user = $stmt->fetch(PDO::FETCH_ASSOC);
      78
      79      return $user ?: [
      80          'first_name' => '',
      81          'last_name' => '',
      82          'birth_date' => '',
      83          'bio' => '',
      84          'photo' => ''
      85      ];
      86 }
      87
                                                                                   12
      В.7 { cart.php }

      GitHub    репозиторій:    https://github.com/NureTretiakovaLiliia/smp-pzpi-23-1-tretiakova-liliia/blob/main/Lab4/smp-pzpi-23-1-tretiakova-liliia-lab4/cart.php

      1 <?php
      2 session_start();
      3
      4 require 'persistence/cart_management.php';
      5 include 'header.php';
      6
      7 if (!isset($_SESSION['user_id'])) {
      8      header("Location: page404.php");
      9 }
      10
      11 $cart = getCartItems($_SESSION['user_id']);
      12
      13 echo "<h2>Кошик</h2>";
      14
      15
      16 if ($_SERVER['REQUEST_METHOD'] === 'POST' &&
      isset($_POST['remove_product_id'])) {
      17      $removeProductId = (int)$_POST['remove_product_id'];
      18      removeFromCart($_SESSION['user_id'], $removeProductId);
      19      header('Location: ' . $_SERVER['REQUEST_URI']);
      20      exit;
      21 }
      22 ?>
      23
      24 <?php if (!empty($cart)): ?>
      25      <table border="1" cellpadding="5" cellspacing="0">
      26          <thead>
      27              <tr>
      28                   <th>id</th>
      29                   <th>Назва</th>
      30                   <th>Кількість</th>
      31                   <th>Ціна</th>
      32                   <th>Сума</th>
      33                   <th>Дія</th>
      34              </tr>
      35          </thead>
      36          <tbody>
      37          <?php
      38              $total = 0;
      39              foreach ($cart as $cart_item):
      40                   $sum = $cart_item['price'] *
      $cart_item['quantity'];
      41                   $total += $sum;
      42          ?>
      43              <tr>
      44                   <td><?= (int)$cart_item['product_id']?></td>
      45                   <td><?= htmlspecialchars($cart_item['title']) ?
      ></td>
      46                   <td><?= (int)$cart_item['quantity'] ?></td>
      47                   <td><?= number_format($cart_item['price'], 2) ?
      ></td>
                                                                                   13
      48
      49
      50                    <td><?= number_format($sum, 2) ?></td>
      51                    <td>
      52                         <form method="POST" style="margin:0;">
      53                             <input type="hidden"
      name="remove_product_id" value="<?= (int)$cart_item['product_id'] ?
      >">
      54                             <button type="submit" onclick="return
      confirm('Видалити цей товар з кошика?')" class="btn btn-
      danger">Видалити</button>
      55                         </form>
      56                    </td>
      57               </tr>
      58          <?php endforeach; ?>
      59          </tbody>
      60          <tfoot>
      61               <tr>
      62                    <td colspan="3" style="text-
      align:right;"><strong>Всього:</strong></td>
      63                    <td colspan="2"><strong><?= number_format($total,
      2) ?> грн</strong></td>
      64               </tr>
      65          </tfoot>
      66      </table>
      67 <?php else: ?>
      68      <p>Ваш кошик порожній. <a href="index.php">Перейти до
      покупок</a></p>
      69 <?php endif; ?>
      70
      71
      72
      73 <?php include 'footer.php'; ?>


      В.8 { footer.php }

      GitHub    репозиторій:    https://github.com/NureTretiakovaLiliia/smp-pzpi-23-1-tretiakova-liliia/blob/main/Lab4/smp-pzpi-23-1-tretiakova-liliia-lab4/footer.php

      ./footer.php
      1 </main>
      2
      3      <footer class="bg-light text-center py-4 mt-auto border-top">
      4          <nav class="d-flex justify-content-center gap-3">
      5              <a href="index.php" class="text-decoration-
      none">Home</a>
      6              <a href="products.php" class="text-decoration-
      none">Products</a>
      7              <a href="cart.php" class="text-decoration-none">Cart</
      a>
      8              <a href="#" class="text-decoration-none">About Us</a>
      9          </nav>
      10      </footer>
      11
      12      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/
                                                                                   14
      dist/js/bootstrap.bundle.min.js"></script>
      13 </body>
      14 </html>


      В.9 { header.php }

      GitHub    репозиторій:    https://github.com/NureTretiakovaLiliia/smp-pzpi-23-1-tretiakova-liliia/blob/main/Lab4/smp-pzpi-23-1-tretiakova-liliia-lab4/header.php

      1 <!DOCTYPE html>
      2 <html lang="uk">
      3 <head>
      4      <meta charset="UTF-8">
      5      <title>Магазин "Весна"</title>
      6      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/
      bootstrap-icons@1.10.5/font/bootstrap-icons.css">
      7      <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.3/
      dist/minty/bootstrap.min.css" rel="stylesheet">
      8 </head>
      9 <body>
      10      <header class="bg-primary text-white p-3 mb-4">
      11          <div class="container">
      12               <div class="d-flex justify-content-between align-
      items-center">
      13                   <h1 class="h3">Магазин "Весна"</h1>
      14                   <nav>
      15                       <a class="btn btn-outline-light me-2"
      href="index.php">
      16                            <i class="bi bi-house"></i>
      17                       </a>
      18                       <a class="btn btn-outline-light me-2"
      href="products.php">Products</a>
      19                       <?php if (isset($_SESSION['user_id'])): ?>
      20                            <a class="btn btn-outline-light me-2"
      href="cart.php">
      21                                 <i class="bi bi-basket-fill"></i>
      22                            </a>
      23                            <a class="btn btn-outline-light me-2"
      href="profile.php" class="text-white fs-4">
      24                                 <i class="bi bi-person-circle"></i>
      25                            </a>
      26                            <a class="btn btn-outline-danger me-2"
      href="logout.php">Logout</a>
      27                       <?php else: ?>
      28                            <a class="btn btn-light"
      href="login.php">Login</a>
      29                       <?php endif; ?>
      30                   </nav>
      31               </div>
      32          </div>
      33      </header>
      34      <main class="container mb-5">
                                                                                   15
      В.10 { index.php }

      GitHub    репозиторій:    https://github.com/NureTretiakovaLiliia/smp-pzpi-23-1-tretiakova-liliia/blob/main/Lab4/smp-pzpi-23-1-tretiakova-liliia-lab4/index.php

      1 <?php
      2
      3 session_start();
      4
      5 require 'persistence/products_management.php';
      6 require 'persistence/cart_management.php';
      7
      8 $products = getAllProducts();
      9 $quantities = [];
      10 $errors = [];
      11
      12 if ($_SERVER['REQUEST_METHOD'] === 'POST') {
      13      if (!isset($_SESSION['username'])) {
      14          header('Location: page404.php');
      15          exit;
      16      }
      17
      18      require_once 'persistence/user_management.php';
      19      $userId = getUserIdByUsername($_SESSION['username']);
      20
      21      if (!empty($_POST['quantity']) &&
      is_array($_POST['quantity'])) {
      22          foreach ($_POST['quantity'] as $productId => $qty) {
      23               $qty = trim($qty);
      24
      25               if (!preg_match('/^\d+$/', $qty)) {
      26                   $errors[] = "Кількість для товару ID $productId
      має бути цілим невід’ємним числом.";
      27               } else {
      28                   $quantities[$productId] = (int)$qty;
      29               }
      30          }
      31      } else {
      32          $errors[] = "Не вказано жодної кількості.";
      33      }
      34
      35      if (empty($errors)) {
      36          foreach ($quantities as $productId => $qty) {
      37               if ($qty > 0) {
      38                   addToCart($userId, $productId, $qty);
      39               }
      40          }
      41          header("Location: cart.php");
      42          exit;
      43      }
      44 }
      45
      46
      47 include 'header.php';
      48
      49 if (!empty($errors)) {
                                                                   16
      50      echo '<script>';
      51      echo 'alert("' . addslashes(implode("\\n", $errors)) . '");';
      52      echo '</script>';
      53 }
      54 ?>
      55
      56 <h2 class="mb-4">Список товарів</h2>
      57
      58 <form method="POST" novalidate>
      59      <div class="list-group">
      60          <?php foreach ($products as $product):
      61               $val = isset($quantities[$product['id']]) ?
      $quantities[$product['id']] : 0;
      62          ?>
      63          <div class="list-group-item d-flex align-items-center
      justify-content-between gap-3 flex-wrap">
      64               <img src="assets/images/<?=
      htmlspecialchars($product['imageUrl'] ?? 'placeholder.jpg') ?>"
      65                    alt="<?= htmlspecialchars($product['title']) ?
      >"
      66                    class="img-thumbnail" style="width: 80px;
      height: 80px; object-fit: cover;">
      67
      68               <div class="flex-grow-1">
      69                   <h5 class="mb-1"><?=
      htmlspecialchars($product['title']) ?></h5>
      70                   <p class="mb-1">Ціна: <?=
      number_format($product['price'], 2) ?> грн</p>
      71               </div>
      72
      73               <div style="min-width: 120px;">
      74                   <label class="form-label mb-0">
      75                       Кількість:
      76                       <input type="number" name="quantity[<?=
      $product['id'] ?>]"
      77                              value="<?= htmlspecialchars($val) ?>"
      min="0" step="1"
      78                              class="form-control form-control-sm">
      79                   </label>
      80               </div>
      81          </div>
      82          <?php endforeach; ?>
      83      </div>
      84
      85      <div class="mt-4">
      86          <button type="submit" class="btn btn-success btn-
      lg">Купити</button>
      87      </div>
      88 </form>
      89
      90
      91
      92 <?php include 'footer.php'; ?>
                                                                                   17
      В.11 { login.php }

      GitHub    репозиторій:    https://github.com/NureTretiakovaLiliia/smp-pzpi-23-1-tretiakova-liliia/blob/main/Lab4/smp-pzpi-23-1-tretiakova-liliia-lab4/login.php

      1 <?php
      2 session_start();
      3
      4 require_once 'persistence/user_management.php';
      5
      6
      7 $error = '';
      8
      9 if ($_SERVER['REQUEST_METHOD'] === 'POST') {
      10      $username = trim($_POST['username'] ?? '');
      11      $password = trim($_POST['password'] ?? '');
      12
      13      if (loginValid($username, $password)) {
      14          $_SESSION['user_id'] = getUserIdByUsername($username);
      15          $_SESSION['username'] = $username;
      16          $_SESSION['login_time'] = time();
      17          header("Location: index.php");
      18      }
      19      else {
      20          $error = 'Невірний логін або пароль.';
      21      }
      22 }
      23
      24 include 'header.php';
      25 ?>
      26
      27 <div class="container mt-5">
      28      <div class="row justify-content-center">
      29          <div class="col-md-6 col-lg-4">
      30              <div class="card shadow">
      31                  <div class="card-body">
      32                      <h4 class="card-title mb-4 text-center">Вхід
      до акаунту</h4>
      33
      34                      <?php if ($error): ?>
      35                          <div class="alert alert-danger"><?=
      htmlspecialchars($error) ?></div>
      36                      <?php endif; ?>
      37
      38                      <form method="POST">
      39                          <div class="mb-3">
      40                              <label for="username" class="form-
      label">Логін</label>
      41                              <input type="text" class="form-
      control" id="username" name="username" required autofocus>
      42                          </div>
      43
      44                          <div class="mb-3">
      45                              <label for="password" class="form-
      label">Пароль</label>
      46                              <input type="password" class="form-
                                                                                    18
      control" id="password" name="password" required>
      47                           </div>
      48
      49                           <button type="submit" class="btn btn-
      primary w-100">Увійти</button>
      50                      </form>
      51                      <p class="text-center mt-3 mb-0">
      52                           Ще не маєте акаунту? <a
      href="register.php">Зареєструйтеся тут</a>
      53                      </p>
      54                  </div>
      55              </div>
      56          </div>
      57      </div>
      58 </div>
      59
      60 <?php include 'footer.php'; ?>


      В.12 { logout.php }

      GitHub    репозиторій:    https://github.com/NureTretiakovaLiliia/smp-pzpi-23-1-tretiakova-liliia/blob/main/Lab4/smp-pzpi-23-1-tretiakova-liliia-lab4/logout.php

      ./logout.php
      1 <?php
      2 session_start();
      3 session_unset();
      4 session_destroy();
      5
      6 header('Location: login.php');
      7 exit;


      В.13 { page404.php }

      GitHub    репозиторій:    https://github.com/NureTretiakovaLiliia/smp-pzpi-23-1-tretiakova-liliia/blob/main/Lab4/smp-pzpi-23-1-tretiakova-liliia-lab4/page404.php

      1 <?php
      2 include 'header.php';
      3 ?>
      4
      5 <h2>Доступ заборонено</h2>
      6 <p>Для перегляду контенту сайту, вам необхідно <a
      href="login.php">пройти авторизацію</a>.</p>
      7
      8 <?php include 'footer.php'; ?>
                                                                                    19
      В.14 { profile.php }

      GitHub    репозиторій:    https://github.com/NureTretiakovaLiliia/smp-pzpi-23-1-tretiakova-liliia/blob/main/Lab4/smp-pzpi-23-1-tretiakova-liliia-lab4/profile.php

      1 <?php
      2 session_start();
      3
      4 $errors = [];
      5 $success = '';
      6 require_once 'persistence/user_management.php';
      7
      8 $profile = [
      9      'first_name' => '',
      10       'last_name' => '',
      11       'birth_date' => '',
      12       'bio' => '',
      13       'photo' => ''
      14 ];
      15
      16 if (isset($_SESSION['user_id'])) {
      17       $profile = getUserProfile((int)$_SESSION['user_id']);
      18 } else {
      19       header('Location: page404.php');
      20 }
      21
      22 if ($_SERVER['REQUEST_METHOD'] === 'POST') {
      23       $profile['first_name'] = trim($_POST['first_name'] ?? '');
      24       $profile['last_name'] = trim($_POST['last_name'] ?? '');
      25       $profile['birth_date'] = $_POST['birth_date'] ?? '';
      26       $profile['bio'] = trim($_POST['bio'] ?? '');
      27
      28       if ($profile['first_name'] === '' ||
      strlen($profile['first_name']) < 2) {
      29           $errors[] = 'Ім’я повинно містити щонайменше 2 символи.';
      30       }
      31
      32      if ($profile['last_name'] === '' ||
      strlen($profile['last_name']) < 2) {
      33           $errors[] = 'Прізвище повинно містити щонайменше 2
      символи.';
      34       }
      35
      36      if ($profile['birth_date'] === '') {
      37           $errors[] = 'Дата народження обов’язкова.';
      38       } else {
      39           $birth = DateTime::createFromFormat('Y-m-d',
      $profile['birth_date']);
      40           $today = new DateTime();
      41           $age = $birth ? $birth->diff($today)->y : 0;
      42           if (!$birth || $age < 16) {
      43                $errors[] = 'Користувач повинен бути старше 16
      років.';
      44           }
      45       }
      46
                                                                    20
      47      if (strlen($profile['bio']) < 50) {
      48          $errors[] = 'Інформація про себе повинна містити
      щонайменше 50 символів.';
      49      }
      50
      51      if (isset($_FILES['photo']) && $_FILES['photo']['error'] ===
      UPLOAD_ERR_OK) {
      52          $fileTmp = $_FILES['photo']['tmp_name'];
      53          $fileName = basename($_FILES['photo']['name']);
      54          $fileExt = strtolower(pathinfo($fileName,
      PATHINFO_EXTENSION));
      55          $allowed = ['jpg', 'jpeg', 'png', 'gif'];
      56
      57          if (!in_array($fileExt, $allowed)) {
      58               $errors[] = 'Дозволені лише JPG, JPEG, PNG, GIF.';
      59          } else {
      60               $newFileName = 'uploads/user_' . time() . '.' .
      $fileExt;
      61               if (!is_dir('uploads')) mkdir('uploads', 0777, true);
      62
      63               if (move_uploaded_file($fileTmp, $newFileName)) {
      64                   $profile['photo'] = $newFileName;
      65               } else {
      66                   $errors[] = 'Не вдалося зберегти фото.';
      67               }
      68          }
      69      }
      70
      71      if (empty($errors)) {
      72
      73          if (isset($_SESSION['user_id'])) {
      74               updateUserProfile((int)$_SESSION['user_id'],
      $profile);
      75          }
      76
      77          $success = 'Профіль оновлено.';
      78      }
      79
      80 }
      81
      82 ?>
      83
      84 <?php include 'header.php'; ?>
      85
      86 <div class="container">
      87      <h2>Профіль користувача</h2>
      88
      89      <?php if (!empty($errors)): ?>
      90      <div class="alert alert-danger">
      91          <ul>
      92               <?php foreach ($errors as $error): ?>
      93                   <li><?= htmlspecialchars($error) ?></li>
      94               <?php endforeach; ?>
      95          </ul>
      96      </div>
      97      <?php endif; ?>
      98
      99      <?php if (!empty($success)): ?>
                                                                         21
      100          <div class="alert alert-success">
      101              <?= htmlspecialchars($success) ?>
      102          </div>
      103      <?php endif; ?>
      104
      105      <div style="display: flex; align-items: flex-start; gap:
      20px;">
      106          <div style="flex-shrink: 0;">
      107              <?php if (!empty($profile['photo'])): ?>
      108                  <img src="<?=
      htmlspecialchars($profile['photo']) ?>" alt="Фото" style="max-width:
      150px; max-height: 200px; border-radius: 8px; object-fit: cover;">
      109              <?php else: ?>
      110                  <div style="width: 150px; height: 200px;
      background: #eee; display: flex; align-items: center; justify-
      content: center; color: #999; border-radius: 8px;">
      111                      Фото відсутнє
      112                  </div>
      113              <?php endif; ?>
      114          </div>
      115
      116
      117          <form method="POST" enctype="multipart/form-data"
      style="flex-grow: 1;">
      118              <div class="mb-3">
      119                  <label for="first_name" class="form-
      label">Ім'я:</label>
      120                  <input type="text" class="form-control"
      name="first_name" id="first_name" value="<?=
      htmlspecialchars($profile['first_name']) ?>">
      121              </div>
      122              <div class="mb-3">
      123                  <label for="last_name" class="form-
      label">Прізвище:</label>
      124                  <input type="text" class="form-control"
      name="last_name" id="last_name" value="<?=
      htmlspecialchars($profile['last_name']) ?>">
      125              </div>
      126              <div class="mb-3">
      127                  <label for="birth_date" class="form-label">Дата
      народження:</label>
      128                  <input type="date" class="form-control"
      name="birth_date" id="birth_date" value="<?=
      htmlspecialchars($profile['birth_date']) ?>">
      129              </div>
      130              <div class="mb-3">
      131                  <label for="bio" class="form-label">Інформація
      про себе:</label>
      132                  <textarea class="form-control" name="bio"
      id="bio" rows="3"><?= htmlspecialchars($profile['bio']) ?></textarea>
      133              </div>
      134              <div class="mb-3">
      135                  <label for="photo" class="form-
      label">Завантажити нове фото:</label>
      136                  <input type="file" class="form-control"
      name="photo" id="photo">
      137              </div>
      138              <button type="submit" class="btn btn-
                                                                                     22
      primary">Зберегти</button>
      139          </form>
      140      </div>
      141 </div>
      142
      143
      144 <?php include 'footer.php'; ?>


      В.15 { register.php }

      GitHub    репозиторій:    https://github.com/NureTretiakovaLiliia/smp-pzpi-23-1-tretiakova-liliia/blob/main/Lab4/smp-pzpi-23-1-tretiakova-liliia-lab4/register.php

      1 <?php
      2 session_start();
      3 require_once 'persistence/user_management.php';
      4
      5 $error = '';
      6
      7 if ($_SERVER['REQUEST_METHOD'] === 'POST') {
      8      $username = trim($_POST['username'] ?? '');
      9      $password = trim($_POST['password'] ?? '');
      10      $confirmPassword = trim($_POST['confirm_password'] ?? '');
      11
      12      if (userExists($username)) {
      13          $error = 'Користувач уже існує. Увійдіть <a
      href="login.php">тут</a>.';
      14      } elseif ($password !== $confirmPassword) {
      15          $error = 'Паролі не збігаються.';
      16      } else {
      17          $result = registerUser($username, $password);
      18
      19          if ($result == true) {
      20               $_SESSION['user_id'] =
      getUserIdByUsername($username);
      21               $_SESSION['username'] = $username;
      22               $_SESSION['login_time'] = time();
      23          }
      24          else {
      25               $error = 'Не вдалося зареєструватися.';
      26          }
      27
      28          header("Location: index.php");
      29          exit;
      30      }
      31 }
      32
      33 include 'header.php';
      34 ?>
      35
      36 <div class="container mt-5">
      37      <div class="row justify-content-center">
      38          <div class="col-md-6 col-lg-4">
      39               <div class="card shadow">
      40                   <div class="card-body">
                                                                       23
      41                      <h4 class="card-title mb-4 text-
      center">Реєстрація</h4>
      42
      43                      <?php if ($error): ?>
      44                           <div class="alert alert-danger"><?=
      $error ?></div>
      45                      <?php endif; ?>
      46
      47                      <form method="POST" novalidate>
      48                           <div class="mb-3">
      49                               <label for="username" class="form-
      label">Логін</label>
      50                               <input type="text" class="form-
      control" id="username" name="username" required>
      51                           </div>
      52
      53                           <div class="mb-3">
      54                               <label for="password" class="form-
      label">Пароль</label>
      55                               <input type="password" class="form-
      control" id="password" name="password" required>
      56                           </div>
      57
      58                           <div class="mb-3">
      59                               <label for="confirm_password"
      class="form-label">Повторіть пароль</label>
      60                               <input type="password" class="form-
      control" id="confirm_password" name="confirm_password" required>
      61                           </div>
      62
      63                           <button type="submit" class="btn btn-
      success w-100">Зареєструватися</button>
      64                      </form>
      65
      66                      <p class="text-center mt-3 mb-0">
      67                           Вже маєте акаунт? <a
      href="login.php">Увійдіть тут</a>
      68                      </p>
      69                  </div>
      70              </div>
      71          </div>
      72      </div>
      73 </div>
      74
      75 <?php include 'footer.php'; ?>
